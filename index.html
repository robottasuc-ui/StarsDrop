<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>StarsDrop Premium Edition</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        /* –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ */
        body { 
            background-color: #050208; 
            color: white; 
            font-family: 'Inter', sans-serif; 
            overflow: hidden; 
            margin: 0; 
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–¥–Ω–∏–π —Ñ–æ–Ω */
        .gradient-bg { 
            background: radial-gradient(circle at top, #160a29 0%, #050208 100%); 
            width: 100%; 
            height: 100vh; 
            position: relative; 
            display: flex; 
            flex-direction: column; 
        }
        
        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å–∫—Ä–æ–ª–ª–∞ –¥–ª—è —Å–ø–∏—Å–∫–∞ –¥–æ–Ω–∞—Ç–æ–≤ */
        #content-stars::-webkit-scrollbar { width: 3px; }
        #content-stars::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
        #content-stars::-webkit-scrollbar-thumb { background: #3d2a54; border-radius: 10px; }

        /* –≠–ª–µ–º–µ–Ω—Ç—ã –Ω–∏–∂–Ω–µ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        .nav-item { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            flex: 1; 
            transition: all 0.3s ease; 
            cursor: pointer; 
            color: #4b5563; 
            padding: 14px 0; 
        }
        .nav-item.active { color: #8b5cf6; transform: translateY(-2px); }
        .nav-text { 
            font-size: 10px; 
            font-weight: 900; 
            letter-spacing: 0.1em; 
            margin-top: 6px; 
            text-transform: uppercase; 
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –∏–≥—Ä–æ–≤—ã—Ö —Ä–µ–∂–∏–º–æ–≤ */
        .game-card { 
            background: rgba(255, 255, 255, 0.02); 
            border: 1px solid rgba(255, 255, 255, 0.05); 
            border-radius: 24px; 
            padding: 22px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        .game-card:active { transform: scale(0.92); background: rgba(255, 255, 255, 0.08); border-color: #8b5cf6; }

        /* –°–∏—Å—Ç–µ–º–∞ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
        .modal-overlay { 
            position: fixed; 
            inset: 0; 
            background: rgba(0,0,0,0.85); 
            z-index: 1000; 
            display: none; 
            align-items: flex-end; 
            backdrop-filter: blur(12px); 
        }
        .modal-content { 
            background: #0d0812; 
            width: 100%; 
            border-radius: 35px 35px 0 0; 
            padding: 28px; 
            border-top: 1px solid #2d1b4e; 
            max-height: 80vh; 
            display: flex; 
            flex-direction: column; 
            box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
        }
        
        /* –ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫ */
        .tab-btn { 
            padding: 16px; 
            font-size: 12px; 
            font-weight: 900; 
            color: #374151; 
            text-align: center; 
            flex: 1; 
            border-bottom: 3px solid transparent; 
            transition: 0.4s; 
            text-transform: uppercase; 
            letter-spacing: 1px;
        }
        .tab-btn.active { color: #8b5cf6; border-bottom-color: #8b5cf6; }

        /* –ö–Ω–æ–ø–∫–∏ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ–ø–ª–∞—Ç—ã */
        .payment-option { 
            background: #130d1a; 
            border: 1px solid #221633; 
            padding: 16px; 
            border-radius: 18px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            transition: all 0.2s; 
            position: relative;
            overflow: hidden;
        }
        .payment-option:active { background: #1c1329; transform: translateY(2px); border-color: #fbbf24; }
        
        .stars-icon { color: #fbbf24; filter: drop-shadow(0 0 5px rgba(251, 191, 36, 0.4)); }

        .btn-close { 
            margin-top: 25px; 
            padding: 15px; 
            font-size: 11px; 
            font-weight: 900; 
            color: #6b7280; 
            text-transform: uppercase; 
            letter-spacing: 3px; 
            background: rgba(255,255,255,0.02);
            border-radius: 15px;
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ª–æ–≥–æ–≤ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ */
        #console-log {
            position: fixed;
            top: 10px; left: 10px; right: 10px;
            background: rgba(0,0,0,0.9);
            border: 1px solid #333;
            color: #00ff41;
            font-family: 'Courier New', monospace;
            font-size: 9px;
            padding: 8px;
            border-radius: 8px;
            z-index: 9999;
            max-height: 120px;
            overflow-y: auto;
            display: none;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="console-log">LOGS INITIALIZED...</div>

    <div class="gradient-bg">
        <div class="flex-1 p-6 overflow-y-auto">
            
            <div class="flex justify-between items-center mb-10">
                <div class="flex items-center gap-4">
                    <div class="relative">
                        <div class="w-12 h-12 rounded-full border-2 border-purple-500/30 overflow-hidden bg-gray-900 shadow-2xl">
                            <img id="user-pic" src="" class="w-full h-full object-cover">
                        </div>
                        <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 border-2 border-[#050208] rounded-full"></div>
                    </div>
                    <div>
                        <div id="user-name" class="text-sm font-black uppercase tracking-wider">User Loading</div>
                        <div id="user-id" class="text-[10px] text-gray-500 font-mono opacity-60">ID: 000000000</div>
                    </div>
                </div>
                
                <div class="flex flex-col gap-2">
                    <div onclick="openPayModal('ton')" class="bg-blue-500/5 border border-blue-500/20 px-4 py-2 rounded-xl flex items-center justify-between min-w-[120px]">
                        <span class="text-[9px] font-black text-blue-500 uppercase">Ton</span>
                        <span id="ton-balance" class="text-xs font-bold font-mono">0.00</span>
                    </div>
                    <div onclick="openPayModal('stars')" class="bg-yellow-500/5 border border-yellow-500/20 px-4 py-2 rounded-xl flex items-center justify-between min-w-[120px]">
                        <span class="text-[9px] font-black text-yellow-500 uppercase">Stars</span>
                        <span id="stars-balance" class="text-xs font-bold font-mono">0</span>
                    </div>
                </div>
            </div>

            <div class="flex flex-col items-center py-8 mb-4">
                <div class="relative mb-6">
                    <div class="absolute inset-0 bg-purple-600/20 blur-[60px] rounded-full"></div>
                    <img src="hero.png" class="w-52 h-52 object-contain relative z-10 transition-transform duration-1000 hover:scale-105">
                </div>
                <h1 class="text-5xl font-black uppercase italic tracking-tighter text-white mb-2">StarsDrop</h1>
                <div class="flex items-center gap-3">
                    <div class="h-[1px] w-8 bg-gradient-to-r from-transparent to-purple-600"></div>
                    <p class="text-[10px] text-purple-400 uppercase tracking-[0.5em] font-black">Loot System</p>
                    <div class="h-[1px] w-8 bg-gradient-to-l from-transparent to-purple-600"></div>
                </div>
            </div>

            <button class="w-full bg-purple-600 hover:bg-purple-500 py-6 rounded-3xl font-black text-xs uppercase tracking-[0.3em] shadow-2xl shadow-purple-900/40 mb-10 active:scale-[0.97] transition-all">
                –ù–∞—á–∞—Ç—å –ø–æ–ª–µ—Ç –≤ –∫–æ—Å–º–æ—Å
            </button>

            <div class="grid grid-cols-3 gap-4 mb-10">
                <div class="game-card">
                    <span class="text-[9px] font-black text-gray-600 uppercase mb-4 tracking-widest">–ö–µ–π—Å—ã</span>
                    <img src="case.png" class="w-12 h-12 object-contain grayscale hover:grayscale-0 transition-all">
                </div>
                <div class="game-card border-purple-500/40 bg-purple-600/10">
                    <span class="text-[9px] font-black text-purple-400 uppercase mb-4 tracking-widest">–†—É–ª–µ—Ç–∫–∞</span>
                    <img src="spin.png" class="w-12 h-12 object-contain">
                </div>
                <div class="game-card">
                    <span class="text-[9px] font-black text-gray-600 uppercase mb-4 tracking-widest">–ú–∏–Ω–∏ </span>
                    <img src="mini.png" class="w-12 h-12 object-contain grayscale hover:grayscale-0 transition-all">
                </div>
            </div>
            
            <div onclick="toggleLogs()" class="text-center text-[8px] text-gray-800 font-bold uppercase tracking-widest py-4">Build 2.0.1 ‚Ä¢ Security Patched</div>
        </div>

        <div class="bg-[#08050c]/80 backdrop-blur-md border-t border-white/5 flex justify-around items-center px-6 pb-8 pt-2">
            <div onclick="openPayModal('ton')" class="nav-item">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <span class="nav-text">–ë–∞–Ω–∫</span>
            </div>
            <div class="nav-item active">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011-1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg>
                <span class="nav-text">–î–æ–º</span>
            </div>
            <div class="nav-item">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                <span class="nav-text">–¢–æ–ø</span>
            </div>
            <div class="nav-item">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                <span class="nav-text">–Ø</span>
            </div>
        </div>
    </div>

    <div id="pay-modal" class="modal-overlay" onclick="closeModals()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="flex mb-8 bg-black/50 rounded-2xl p-1.5 border border-white/5">
                <div id="tab-ton" onclick="switchTab('ton')" class="tab-btn active">Crypto TON</div>
                <div id="tab-stars" onclick="switchTab('stars')" class="tab-btn">Premium Stars</div>
            </div>

            <div id="content-ton" class="grid grid-cols-2 gap-4 animate-in fade-in duration-300">
                <div onclick="payTon(1)" class="payment-option">
                    <span class="text-white font-black text-lg">1.0 TON</span>
                    <span class="text-[9px] text-gray-500 uppercase mt-2 font-bold tracking-widest">–°—Ç–∞—Ä—Ç</span>
                </div>
                <div onclick="payTon(10)" class="payment-option border-purple-500/40 bg-purple-500/5">
                    <div class="absolute top-2 right-2 w-2 h-2 bg-purple-500 rounded-full animate-ping"></div>
                    <span class="text-purple-400 font-black text-lg">10.0 TON</span>
                    <span class="text-[9px] text-purple-400/60 uppercase mt-2 font-bold tracking-widest">–õ—É—á—à–µ–µ</span>
                </div>
            </div>

            <div id="content-stars" class="hidden overflow-y-auto pr-2">
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <script>
                        // –¢–í–û–ô –¢–û–ß–ù–´–ô –°–ü–ò–°–û–ö –ß–ò–°–ï–õ
                        const packs = [25, 50, 75, 100, 150, 200, 250, 300, 350, 400, 500, 550, 650, 750, 900, 1000, 1500];
                        packs.forEach(amount => {
                            document.write(`
                                <div onclick="payStars(${amount})" class="payment-option group">
                                    <div class="flex items-center gap-2">
                                        <span class="stars-icon text-lg">‚òÖ</span>
                                        <span class="font-black text-white text-base">${amount}</span>
                                    </div>
                                    <span class="text-[8px] text-gray-600 font-black uppercase mt-2 group-active:text-yellow-500 transition-colors">–ö—É–ø–∏—Ç—å</span>
                                </div>
                            `);
                        });
                    </script>
                </div>
            </div>

            <button onclick="closeModals()" class="btn-close">–ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ</button>
        </div>
    </div>

    <script>
        /**
         * –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
         */
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();
        
        // –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏ –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É ngrok
        const API_URL = 'https://perilous-unfasciated-nikita.ngrok-free.dev'; 

        const logger = document.getElementById('console-log');
        function addLog(text) {
            const entry = document.createElement('div');
            entry.textContent = `> ${text}`;
            logger.appendChild(entry);
            logger.scrollTop = logger.scrollHeight;
        }

        function toggleLogs() {
            logger.style.display = logger.style.display === 'block' ? 'none' : 'block';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Ton Connect
        const tonConnectUI = new TONConnectUI.TonConnectUI({
            manifestUrl: 'https://raw.githubusercontent.com/ton-community/tutorials/main/03-client/manifest.json'
        });

        // –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const user = tg.initDataUnsafe?.user;
        if (user) {
            document.getElementById('user-name').innerText = (user.username || user.first_name).toUpperCase();
            document.getElementById('user-id').innerText = `ID: ${user.id}`;
            if (user.photo_url) {
                document.getElementById('user-pic').src = user.photo_url;
            } else {
                document.getElementById('user-pic').src = `https://ui-avatars.com/api/?name=${user.first_name}&background=160a29&color=8b5cf6`;
            }
            addLog(`AUTH SUCCESS: ${user.id}`);
        }

        /**
         * –õ–æ–≥–∏–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
         */
        function openPayModal(tab) {
            document.getElementById('pay-modal').style.display = 'flex';
            switchTab(tab);
            tg.HapticFeedback.impactOccurred('medium');
        }

        function closeModals() {
            document.getElementById('pay-modal').style.display = 'none';
        }

        function switchTab(type) {
            const tTab = document.getElementById('tab-ton'), sTab = document.getElementById('tab-stars');
            const tCon = document.getElementById('content-ton'), sCon = document.getElementById('content-stars');
            
            if(type === 'ton') {
                tTab.classList.add('active'); sTab.classList.remove('active');
                tCon.classList.remove('hidden'); sCon.classList.add('hidden');
            } else {
                sTab.classList.add('active'); tTab.classList.remove('active');
                sCon.classList.remove('hidden'); tCon.classList.add('hidden');
            }
            tg.HapticFeedback.selectionChanged();
        }

        /**
         * –§–£–ù–ö–¶–ò–Ø –û–ü–õ–ê–¢–´ –ó–í–ï–ó–î–ê–ú–ò
         */
        async function payStars(amount) {
            addLog(`REQUEST STARS: ${amount}`);
            try {
                // –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ —Ç–≤–æ–µ–º—É –±–æ—Ç—É —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä
                const response = await fetch(`${API_URL}/create_stars_invoice/${user.id}/${amount}`);
                
                if (!response.ok) {
                    addLog(`SERVER ERROR: ${response.status}`);
                    tg.showAlert(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status}`);
                    return;
                }

                const data = await response.json();
                addLog(`LINK RECEIVED: ${data.link ? 'YES' : 'NO'}`);

                if(data.link) {
                    tg.openInvoice(data.link, function(status) {
                        addLog(`INVOICE STATUS: ${status}`);
                        if(status === 'paid') {
                            tg.showAlert('üî• –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞! –ó–≤–µ–∑–¥—ã –≤ –ø—É—Ç–∏.');
                            updateBalance();
                            closeModals();
                        }
                    });
                } else {
                    tg.showAlert('–û—à–∏–±–∫–∞: –°–µ—Ä–≤–µ—Ä –Ω–µ –≤–µ—Ä–Ω—É–ª —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É.');
                }
            } catch (error) {
                addLog(`CRITICAL ERROR: ${error.message}`);
                tg.showPopup({
                    title: "–ù–µ—Ç —Å–≤—è–∑–∏",
                    message: "–ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç. –£–±–µ–¥–∏—Å—å, —á—Ç–æ Python –∑–∞–ø—É—â–µ–Ω –∏ ngrok –∞–∫—Ç–∏–≤–µ–Ω.",
                    buttons: [{type: "ok"}]
                });
            }
        }

        /**
         * –§–£–ù–ö–¶–ò–Ø –û–ü–õ–ê–¢–´ TON
         */
        async function payTon(amount) {
            addLog(`REQUEST TON: ${amount}`);
            if (!tonConnectUI.connected) {
                addLog(`CONNECTING WALLET...`);
                await tonConnectUI.openModal();
                return;
            }
            
            const transaction = {
                validUntil: Math.floor(Date.now() / 1000) + 360,
                messages: [{
                    address: "UQD3Ova8MrxhXHacmHgQVcT-TTLF8pZYKBo67egsBCl6M8Yx",
                    amount: (amount * 1000000000).toString(),
                    payload: btoa(user.id.toString())
                }]
            };

            try {
                await tonConnectUI.sendTransaction(transaction);
                addLog(`TX SENT`);
                tg.showAlert('–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ —Å–µ—Ç—å!');
            } catch (e) {
                addLog(`TX FAILED: ${e.message}`);
            }
        }

        /**
         * –§–æ–Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
         */
        async function updateBalance() {
            if (!user) return;
            try {
                const response = await fetch(`${API_URL}/get_balance/${user.id}`);
                const data = await response.json();
                
                document.getElementById('ton-balance').innerText = data.balance.toFixed(2);
                document.getElementById('stars-balance').innerText = data.stars;
                addLog(`BALANCE UPDATED`);
            } catch (e) {
                addLog(`BALANCE FETCH FAILED`);
            }
        }

        // –ó–∞–ø—É—Å–∫ —Ü–∏–∫–ª–æ–≤
        setInterval(updateBalance, 12000);
        updateBalance();
    </script>
</body>
</html>
