<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>StarsGames Hub</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        body { 
            background-color: #050a05; 
            color: white; 
            font-family: 'Inter', sans-serif; 
            margin: 0; 
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .game-card {
            background: #111811;
            border-radius: 24px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all 0.2s ease;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .game-card:active {
            transform: scale(0.96);
            background: #1a231a;
        }

        .icon-container {
            width: 60px;
            height: 60px;
            background: #1a231a;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            overflow: hidden;
            border: 1px solid rgba(34, 197, 94, 0.2);
        }

        .icon-container img {
            width: 80%;
            height: 80%;
            object-fit: contain;
        }

        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
            z-index: 100;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }
    </style>
</head>
<body class="p-6">

    <div class="max-w-md mx-auto w-full flex flex-col h-full">
        <header class="mb-10 pt-4">
            <h1 class="text-4xl font-black italic tracking-tighter uppercase">
                STARS<span class="text-green-500">GAMES</span>
            </h1>
            <p class="text-gray-500 text-[10px] font-bold uppercase tracking-widest">Arcade Hub System</p>
        </header>

        <div class="space-y-4">
            
            <div onclick="window.location.href='Lovlyagift.html'" class="game-card">
                <div class="icon-container">
                    <img src="img/pepe.png" alt="Pepe">
                </div>
                <div class="flex-1">
                    <h3 class="font-black uppercase text-sm tracking-tight">–õ–æ–≤–ª—è –ø–æ–¥–∞—Ä–∫–æ–≤</h3>
                    <p id="gift-timer" class="text-gray-500 text-[10px] font-bold uppercase">–î–æ—Å—Ç—É–ø–Ω–æ —Ä–∞–∑ –≤ 24 —á–∞—Å–∞</p>
                </div>
                <div class="text-green-500 opacity-50">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                </div>
            </div>

            <div onclick="checkClickerAccess()" class="game-card">
                <div class="icon-container">
                    <img src="img/helmet.png" alt="Helmet">
                </div>
                <div class="flex-1">
                    <h3 class="font-black uppercase text-sm tracking-tight">StarClicker</h3>
                    <p id="clicker-status" class="text-gray-500 text-[10px] font-bold uppercase">–ö—É–ø–∏—Ç—å –¥–æ—Å—Ç—É–ø –∑–∞ 50 ‚≠ê</p>
                </div>
                <div id="clicker-lock" class="text-gray-600">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z"></path></svg>
                </div>
            </div>

        </div>

        <div class="mt-auto pb-6">
            <button onclick="window.location.href='index.html'" class="w-full bg-[#111811] text-gray-400 font-black py-5 rounded-3xl uppercase text-[11px] tracking-widest border border-white/5 active:bg-[#1a231a] transition-all">
                –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
            </button>
        </div>
    </div>

    <div id="buy-modal" class="modal">
        <div class="bg-[#0f140f] border border-green-500/20 p-8 rounded-[40px] w-full max-w-xs text-center">
            <img src="img/helmet.png" class="w-20 h-20 mx-auto mb-4" alt="Helmet">
            <h2 class="text-2xl font-black uppercase mb-2 leading-none">–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</h2>
            <p class="text-gray-400 text-sm mb-8 font-medium">–î–æ—Å—Ç—É–ø –∫ StarClicker –Ω–∞–≤—Å–µ–≥–¥–∞ –∑–∞ 50 –∑–≤—ë–∑–¥</p>
            
            <button id="buy-btn" onclick="buyClicker()" class="w-full bg-green-500 text-black font-black py-4 rounded-2xl uppercase text-sm mb-4 shadow-[0_8px_20px_rgba(34,197,94,0.3)]">
                –û–ø–ª–∞—Ç–∏—Ç—å 50 ‚≠ê
            </button>
            
            <button onclick="closeModal()" class="text-gray-500 font-bold uppercase text-[10px] tracking-widest">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        const BACKEND_URL = 'https://stars-drop.vercel.app/api';
        const user = tg.initDataUnsafe?.user;

        let stars = parseInt(localStorage.getItem('user_stars') || '0');
        let clickerAccess = localStorage.getItem('clicker_unlocked') === 'true';

        function updateUI() {
            if (clickerAccess) {
                document.getElementById('clicker-status').innerText = "–î–æ—Å—Ç—É–ø –æ—Ç–∫—Ä—ã—Ç";
                document.getElementById('clicker-status').classList.replace('text-gray-500', 'text-green-500');
                document.getElementById('clicker-lock').innerHTML = 'üöÄ';
            }

            const lastGift = localStorage.getItem('last_gift_time');
            if (lastGift) {
                const timeLeft = (24 * 60 * 60 * 1000) - (Date.now() - parseInt(lastGift));
                if (timeLeft > 0) {
                    const hours = Math.floor(timeLeft / (1000 * 60 * 60));
                    document.getElementById('gift-timer').innerText = `–û—Ç–∫–∞—Ç: ${hours}—á.`;
                }
            }
        }

        async function buyClicker() {
            if (stars >= 50) {
                if (user?.id) {
                    try {
                        await fetch(`${BACKEND_URL}/update_balance`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ user_id: user.id, stars: -50, points: 0 })
                        });
                        
                        stars -= 50;
                        localStorage.setItem('user_stars', stars);
                        localStorage.setItem('clicker_unlocked', 'true');
                        clickerAccess = true;
                        
                        closeModal();
                        updateUI();
                        tg.HapticFeedback.notificationOccurred('success');
                        tg.showPopup({ message: "StarClicker —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!" });
                    } catch (e) {
                        tg.showPopup({ message: "–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º" });
                    }
                }
            } else {
                tg.HapticFeedback.notificationOccurred('error');
                tg.showPopup({ message: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤–µ–∑–¥!" });
            }
        }

        function checkClickerAccess() {
            if (clickerAccess) window.location.href = 'clicker.html';
            else document.getElementById('buy-modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('buy-modal').style.display = 'none';
        }

        updateUI();
    </script>
</body>
</html>
