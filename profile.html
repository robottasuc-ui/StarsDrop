<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Profile - StarsDrop</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        :root { --accent-green: #a3e635; --bg-dark: #0a1205; }
        body { background: var(--bg-dark); color: white; font-family: 'Inter', sans-serif; margin: 0; height: 100vh; overflow: hidden; }
        .glass-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(163, 230, 53, 0.1); backdrop-filter: blur(15px); border-radius: 24px; }
        
        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å–∫—Ä–æ–ª–ª–∞ */
        .inventory-container { 
            max-height: 380px; 
            overflow-y: auto; 
            padding-right: 8px;
        }
        .inventory-container::-webkit-scrollbar { width: 4px; }
        .inventory-container::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); }
        .inventory-container::-webkit-scrollbar-thumb { background: var(--accent-green); border-radius: 10px; }

        .inventory-slot { aspect-ratio: 1/1; background: rgba(163, 230, 53, 0.05); border: 1px dashed rgba(163, 230, 53, 0.2); border-radius: 16px; display: flex; align-items: center; justify-content: center; position: relative; }
        .active-item { border: 1px solid var(--accent-green); background: rgba(163, 230, 53, 0.1); }
        .btn-green { background: var(--accent-green); color: black; font-weight: 900; border-radius: 14px; }
    </style>
</head>
<body class="p-6">

    <button onclick="location.href='index.html'" class="mb-4 bg-white/5 p-3 rounded-xl border border-white/10">
        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg>
    </button>

    <div class="flex flex-col items-center mb-6">
        <div class="relative">
            <img id="user-avatar" src="" class="w-20 h-20 rounded-full border-2 border-green-500 object-cover shadow-[0_0_15px_rgba(163,230,53,0.3)]">
            <div id="donate-status" class="absolute -bottom-2 left-1/2 -translate-x-1/2 text-[9px] px-3 py-1 bg-gray-600 rounded-full font-black">GUEST</div>
        </div>
        <div id="stars-display" class="mt-4 text-yellow-400 font-black text-xl italic uppercase">‚≠ê 0</div>
    </div>

    <div class="glass-card p-5">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-[10px] font-black uppercase text-green-400 tracking-widest">–¢–≤–æ–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
            <span id="inv-count" class="text-[10px] text-white/30 italic">0/0</span>
        </div>
        
        <div class="inventory-container">
            <div id="inventory-grid" class="grid grid-cols-3 gap-3">
                </div>
        </div>
    </div>

    <div id="item-modal" class="fixed inset-0 bg-black/95 hidden z-[200] items-center justify-center p-8 backdrop-blur-md">
        <div class="glass-card w-full max-w-xs p-8 text-center border-green-500/30">
            <img id="modal-img" src="" class="w-24 h-24 mx-auto mb-4 object-contain">
            <h2 id="modal-title" class="text-xl font-black uppercase mb-1">–ü–†–ï–î–ú–ï–¢</h2>
            <p id="modal-price-info" class="text-green-400 text-[10px] font-bold mb-6 tracking-widest"></p>
            
            <div class="flex flex-col gap-3">
                <button id="withdraw-btn" onclick="sendWithdrawRequest()" class="w-full btn-green py-4 text-sm uppercase hidden">–í–´–í–ï–°–¢–ò –í –ë–û–¢</button>
                <button id="unlock-btn" onclick="processDonate()" class="w-full bg-blue-600 text-white py-4 rounded-xl text-[10px] font-black uppercase hidden">–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤—ã–≤–æ–¥ (75 ‚≠ê)</button>
                <button id="modal-sell-btn" onclick="handleSell()" class="bg-white/5 py-4 rounded-xl text-[xs] font-bold border border-white/10 italic">–ü–†–û–î–ê–¢–¨</button>
                <button onclick="closeModal()" class="text-white/20 text-[10px] mt-2 uppercase font-black">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        let selectedIndex = null;

        const BOT_TOKEN = '–¢–í–û–ô_–¢–û–ö–ï–ù';
        const ADMIN_ID = '–¢–í–û–ô_ID';

        // –¢–í–û–Ø –ë–ê–ó–ê –ü–†–ï–î–ú–ï–¢–û–í
        const ITEMS_DB = {
            1: { name: "1 May", price: 100 }, 2: { name: "2025", price: 500 }, 3: { name: "Bear", price: 3500 },
            4: { name: "Book", price: 1000 }, 5: { name: "Berry Box", price: 700 }, 6: { name: "Boot", price: 400 },
            7: { name: "Jack Box", price: 600 }, 8: { name: "Car", price: 5000 }, 9: { name: "Rocket", price: 50 },
            16: { name: "Star Ring", price: 3000 }, 17: { name: "Gingerbread", price: 500 }, 18: { name: "Suitcase", price: 5000 },
            19: { name: "Cigar", price: 3000 }, 20: { name: "Blue Ring", price: 2500 }, 21: { name: "Costume", price: 10000 },
            22: { name: "Flower", price: 1000 }, 23: { name: "Rich Dog", price: 500 }, 24: { name: "Perfume", price: 10000 },
            25: { name: "Lantern", price: 100 }, 26: { name: "Coffin", price: 5000 }, 27: { name: "Lava Lips", price: 5000 },
            28: { name: "B-Day Cake", price: 200 }, 29: { name: "Heart Lock", price: 2000 }, 30: { name: "Spartan", price: 25000 },
            39: { name: "Calendar", price: 400 }, 40: { name: "Red Cap", price: 100000 }, 41: { name: "Brick", price: 10000 },
            42: { name: "Cocktail", price: 150 }, 43: { name: "Green Mix", price: 500 }, 44: { name: "Atomic Cat", price: 10000 },
            45: { name: "Cauldron", price: 500 }, 46: { name: "Bow Tie", price: 600 }, 47: { name: "Lollipop", price: 500 },
            48: { name: "Clover", price: 500 }, 49: { name: "Muffin", price: 700 }, 50: { name: "Lightsaber", price: 700 },
            51: { name: "SD Token", price: 600 }, 53: { name: "Sneakers", price: 10000 }, 54: { name: "Glasses", price: 30000 },
            55: { name: "Eagle", price: 5000 }, 56: { name: "Dove Post", price: 150 }, 57: { name: "Easter Cake", price: 75 },
            58: { name: "Rocket", price: 500 }, 59: { name: "Rose", price: 2000 }, 60: { name: "Backpack", price: 500 },
            61: { name: "Santa Hat", price: 500 }, 62: { name: "Crystal Ball", price: 1000 }, 63: { name: "Helmet Biker", price: 3500 },
            64: { name: "Pacifier", price: 3000 }, 65: { name: "Golden Star", price: 15 }, 66: { name: "Statue", price: 41000 },
            69: { name: "Wreath", price: 500 }, 70: { name: "Spotted Egg", price: 600 }, 71: { name: "Green Slime", price: 700 },
            72: { name: "Snake", price: 500 }
        };

        // –§–£–ù–ö–¶–ò–Ø –ü–û–ò–°–ö–ê –ü–†–ï–î–ú–ï–¢–ê –ü–û –ò–ú–ï–ù–ò –ò–õ–ò ID
        function getItemData(item) {
            // –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –ø–æ ID
            if (item.id && ITEMS_DB[item.id]) return ITEMS_DB[item.id];
            
            // –ï—Å–ª–∏ ID –Ω–µ—Ç, –∏—â–µ–º –ø–æ –∏–º–µ–Ω–∏ (Name)
            const entry = Object.values(ITEMS_DB).find(dbItem => dbItem.name === item.name);
            return entry || { name: item.name, price: 1 }; // –ï—Å–ª–∏ —Å–æ–≤—Å–µ–º –Ω–µ—Ç –≤ –±–∞–∑–µ - 1 –∑–≤–µ–∑–¥–∞
        }

        function loadProfile() {
            const items = JSON.parse(localStorage.getItem('user_inventory')) || [];
            const stars = localStorage.getItem('user_stars') || "0";
            const isDonator = localStorage.getItem('has_donated') === 'true';

            document.getElementById('stars-display').innerText = `‚≠ê ${stars}`;
            document.getElementById('inv-count').innerText = `${items.length} –ü–†–ï–î–ú.`;

            if (isDonator) {
                document.getElementById('donate-status').innerText = "PREMIUM";
                document.getElementById('donate-status').className = "absolute -bottom-2 left-1/2 -translate-x-1/2 text-[9px] px-3 py-1 bg-green-500 text-black rounded-full font-black shadow-[0_0_10px_#a3e635]";
            }
            
            const grid = document.getElementById('inventory-grid');
            grid.innerHTML = '';
            
            // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –≤—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            items.forEach((item, index) => {
                const slot = document.createElement('div');
                slot.className = 'inventory-slot active-item';
                slot.innerHTML = `<img src="${item.img}" class="w-12 h-12 object-contain">`;
                slot.onclick = () => openItem(index, item);
                grid.appendChild(slot);
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–µ —Å–ª–æ—Ç—ã, –µ—Å–ª–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –º–µ–Ω—å—à–µ 6 (–¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã)
            for (let i = items.length; i < 6; i++) {
                const empty = document.createElement('div');
                empty.className = 'inventory-slot opacity-20';
                empty.innerHTML = `<span class="text-[8px] font-black">EMPTY</span>`;
                grid.appendChild(empty);
            }
        }

        function openItem(index, item) {
            selectedIndex = index;
            const data = getItemData(item); // –ò—â–µ–º —Ä–µ–∞–ª—å–Ω—É—é —Ü–µ–Ω—É
            const isDonator = localStorage.getItem('has_donated') === 'true';

            document.getElementById('modal-img').src = item.img;
            document.getElementById('modal-title').innerText = data.name;
            document.getElementById('modal-price-info').innerText = `–¶–ï–ù–ê –ü–†–û–î–ê–ñ–ò: ${data.price} ‚≠ê`;
            document.getElementById('modal-sell-btn').innerText = `–ü–†–û–î–ê–¢–¨ –ó–ê ${data.price} ‚≠ê`;

            const withdrawBtn = document.getElementById('withdraw-btn');
            const unlockBtn = document.getElementById('unlock-btn');

            if (isDonator) {
                withdrawBtn.classList.remove('hidden');
                unlockBtn.classList.add('hidden');
            } else {
                withdrawBtn.classList.add('hidden');
                unlockBtn.classList.remove('hidden');
            }
            document.getElementById('item-modal').style.display = 'flex';
        }

        function handleSell() {
            let items = JSON.parse(localStorage.getItem('user_inventory')) || [];
            const item = items[selectedIndex];
            const data = getItemData(item);

            let s = parseInt(localStorage.getItem('user_stars')) || 0;
            localStorage.setItem('user_stars', (s + data.price).toString());
            
            items.splice(selectedIndex, 1);
            localStorage.setItem('user_inventory', JSON.stringify(items));
            
            closeModal();
            loadProfile();
            tg.HapticFeedback.notificationOccurred('success');
        }

        function processDonate() {
            tg.showConfirm("–û–ø–ª–∞—Ç–∏—Ç—å 75 ‚≠ê –∑–∞ –¥–æ—Å—Ç—É–ø –∫ –≤—ã–≤–æ–¥—É?", (ok) => {
                if(ok) {
                    localStorage.setItem('has_donated', 'true');
                    loadProfile();
                    closeModal();
                }
            });
        }

        async function sendWithdrawRequest() {
            const items = JSON.parse(localStorage.getItem('user_inventory')) || [];
            const item = items[selectedIndex];
            const user = tg.initDataUnsafe?.user || { id: '000', first_name: 'Player' };
            const text = `üö® –í–´–í–û–î\n–Æ–∑–µ—Ä: ${user.first_name}\nID: ${user.id}\n–ü—Ä–µ–¥–º–µ—Ç: ${item.name}`;

            try {
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chat_id: ADMIN_ID, text: text })
                });
                items.splice(selectedIndex, 1);
                localStorage.setItem('user_inventory', JSON.stringify(items));
                closeModal(); loadProfile();
                tg.showAlert("–ó–∞—è–≤–∫–∞ —É—à–ª–∞!");
            } catch (e) { tg.showAlert("–û—à–∏–±–∫–∞!"); }
        }

        function closeModal() { document.getElementById('item-modal').style.display = 'none'; }

        window.onload = () => {
            const u = tg.initDataUnsafe?.user;
            if(u) {
                document.getElementById('user-name').innerText = u.first_name.toUpperCase();
                document.getElementById('user-avatar').src = u.photo_url || 'https://ui-avatars.com/api/?name=' + u.first_name;
            }
            loadProfile();
        }
    </script>
</body>
</html>
