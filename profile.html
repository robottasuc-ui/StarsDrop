<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Profile - StarsDrop Green</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        :root { --accent-green: #a3e635; --bg-dark: #0a1205; }
        body { background: var(--bg-dark); color: white; font-family: 'Inter', sans-serif; margin: 0; padding-bottom: 120px; }
        .glass-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(163, 230, 53, 0.1); backdrop-filter: blur(15px); border-radius: 24px; }
        .inventory-slot { aspect-ratio: 1/1; background: rgba(163, 230, 53, 0.05); border: 1px dashed rgba(163, 230, 53, 0.2); border-radius: 16px; display: flex; align-items: center; justify-content: center; }
        .active-item { border: 1px solid var(--accent-green); background: rgba(163, 230, 53, 0.1); box-shadow: 0 0 15px rgba(163, 230, 53, 0.1); }
        .btn-green { background: var(--accent-green); color: black; font-weight: 900; border-radius: 14px; transition: 0.2s; }
        .btn-green:active { transform: scale(0.95); }
        .status-badge { font-size: 10px; padding: 2px 10px; border-radius: 20px; text-transform: uppercase; font-weight: 900; }
    </style>
</head>
<body>
    <div class="p-6">
        <button onclick="location.href='index.html'" class="mb-6 bg-white/5 p-3 rounded-xl border border-white/10">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg>
        </button>

        <div class="flex flex-col items-center mb-8">
            <div class="relative">
                <img id="user-avatar" src="" class="w-24 h-24 rounded-full border-2 border-green-500 mb-4 object-cover">
                <div id="donate-status" class="absolute -bottom-2 left-1/2 -translate-x-1/2 status-badge bg-gray-600 text-white/50">GUEST</div>
            </div>
            <h2 id="user-name" class="text-2xl font-black italic uppercase mt-4">–ó–ê–ì–†–£–ó–ö–ê...</h2>
            <div id="stars-display" class="mt-2 text-yellow-400 font-black text-xl">‚≠ê 0</div>
        </div>

        <div class="glass-card p-5 mb-6">
            <h3 class="text-[10px] font-black uppercase text-green-400 mb-3 tracking-widest text-center">–ê–∫—Ç–∏–≤–∞—Ü–∏—è –±–æ–Ω—É—Å–æ–≤</h3>
            <div class="flex gap-2">
                <input id="promo-input" type="text" placeholder="–ö–û–î..." class="w-full bg-black/40 border border-white/10 rounded-xl px-4 py-3 text-sm outline-none focus:border-green-500 transition-all">
                <button onclick="activatePromo()" class="btn-green px-6 text-sm">OK</button>
            </div>
        </div>

        <div class="glass-card p-5">
            <div class="flex justify-between items-center mb-4 px-1">
                <h3 class="text-[10px] font-black uppercase text-green-400 tracking-widest">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
                <span id="inv-count" class="text-[10px] font-bold text-white/30 italic">0/6</span>
            </div>
            <div id="inventory-grid" class="grid grid-cols-3 gap-3"></div>
        </div>
    </div>

    <div id="item-modal" class="fixed inset-0 bg-black/95 hidden z-[200] items-center justify-center p-8 backdrop-blur-md">
        <div class="glass-card w-full max-w-xs p-8 text-center border-green-500/40">
            <img id="modal-img" src="" class="w-28 h-28 mx-auto mb-6 object-contain">
            <h2 id="modal-title" class="text-2xl font-black uppercase mb-2 italic">–ü–†–ï–î–ú–ï–¢</h2>
            <p id="modal-price-info" class="text-green-400 text-xs font-bold mb-8 opacity-80"></p>
            
            <div class="flex flex-col gap-3">
                <div id="withdraw-section">
                    <button id="withdraw-btn" onclick="sendWithdrawRequest()" class="w-full btn-green py-5 text-sm uppercase tracking-tighter hidden">–í–´–í–ï–°–¢–ò –í –ë–û–¢</button>
                    <button id="unlock-btn" onclick="processDonate()" class="w-full bg-blue-600 hover:bg-blue-500 text-white py-5 rounded-2xl text-[10px] font-black uppercase tracking-widest hidden">–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤—ã–≤–æ–¥ (75 ‚≠ê)</button>
                </div>
                
                <button id="modal-sell-btn" onclick="handleSell()" class="bg-white/5 py-4 rounded-xl text-xs font-bold border border-white/10">–ü–†–û–î–ê–¢–¨</button>
                <button onclick="closeModal()" class="text-white/20 text-[10px] mt-4 uppercase font-black hover:text-white transition">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let selectedIndex = null;
        
        // --- –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ó–ê–ü–û–õ–ù–ò –≠–¢–û ---
        const BOT_TOKEN = '8451029637:AAHF6jJdQ98QhYRRsJxH_wuktMeE5QctT-I'; 
        const ADMIN_ID = '8015661230';

        // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
        const ITEMS_DB = {
            1: { name: "1 May", price: 100 }, 2: { name: "2025", price: 500 },
            3: { name: "Bear", price: 3500 }, 4: { name: "Book", price: 1000 },
            7: { name: "Jack Box", price: 600 }, 8: { name: "Car", price: 5000 },
            23: { name: "Rich Dog", price: 500 }, 44: { name: "Atomic Cat", price: 10000 },
            65: { name: "Golden Star", price: 15 }, 27: { name: "Lava Lips", price: 5000 }
        };

        function loadProfile() {
            const items = JSON.parse(localStorage.getItem('user_inventory')) || [];
            const stars = localStorage.getItem('user_stars') || "0";
            const isDonator = localStorage.getItem('has_donated') === 'true';

            document.getElementById('stars-display').innerText = `‚≠ê ${stars}`;
            document.getElementById('inv-count').innerText = `${items.length}/6`;

            const statusBadge = document.getElementById('donate-status');
            if (isDonator) {
                statusBadge.innerText = "PREMIUM";
                statusBadge.className = "absolute -bottom-2 left-1/2 -translate-x-1/2 status-badge bg-green-500 text-black";
            }
            
            const grid = document.getElementById('inventory-grid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 6; i++) {
                const slot = document.createElement('div');
                slot.className = 'inventory-slot' + (items[i] ? ' active-item' : '');
                if (items[i]) {
                    slot.innerHTML = `<img src="${items[i].img}" class="w-14 h-14 object-contain">`;
                    slot.onclick = () => openItem(i, items[i]);
                } else {
                    slot.innerHTML = `<span class="text-[8px] text-white/5 font-black uppercase tracking-widest">–ü—É—Å—Ç–æ</span>`;
                }
                grid.appendChild(slot);
            }
        }

        function openItem(index, item) {
            selectedIndex = index;
            const data = ITEMS_DB[item.id] || { name: item.name, price: 1 };
            const isDonator = localStorage.getItem('has_donated') === 'true';

            document.getElementById('modal-img').src = item.img;
            document.getElementById('modal-title').innerText = data.name;
            document.getElementById('modal-price-info').innerText = `–û–¶–ï–ù–ö–ê: ${data.price} –ó–í–ï–ó–î`;
            document.getElementById('modal-sell-btn').innerText = `–ü–†–û–î–ê–¢–¨ –ó–ê ${data.price} ‚≠ê`;

            const withdrawBtn = document.getElementById('withdraw-btn');
            const unlockBtn = document.getElementById('unlock-btn');

            if (isDonator) {
                withdrawBtn.classList.remove('hidden');
                unlockBtn.classList.add('hidden');
            } else {
                withdrawBtn.classList.add('hidden');
                unlockBtn.classList.remove('hidden');
            }
            document.getElementById('item-modal').style.display = 'flex';
        }

        function processDonate() {
            tg.showConfirm("–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤—ã–≤–æ–¥ –Ω–∞–≤—Å–µ–≥–¥–∞ –∑–∞ 75 ‚≠ê?", (ok) => {
                if(ok) {
                    // –°–∏–º—É–ª—è—Ü–∏—è —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
                    localStorage.setItem('has_donated', 'true');
                    tg.showAlert("‚úÖ –í–´–í–û–î –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ê–ù!");
                    loadProfile();
                    closeModal();
                }
            });
        }

        async function sendWithdrawRequest() {
            const items = JSON.parse(localStorage.getItem('user_inventory')) || [];
            const item = items[selectedIndex];
            const user = tg.initDataUnsafe?.user || { id: 'unknown', first_name: 'Player' };

            const text = `üö® <b>–ó–ê–Ø–í–ö–ê –ù–ê –í–´–í–û–î</b>\n\nüë§ –ò–≥—Ä–æ–∫: <b>${user.first_name}</b>\nüÜî ID: <code>${user.id}</code>\nüîó –Æ–∑–µ—Ä: @${user.username || '–Ω–µ—Ç'}\n\nüéÅ –ü—Ä–µ–¥–º–µ—Ç: <b>${item.name}</b>`;

            try {
                const res = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chat_id: ADMIN_ID, text: text, parse_mode: 'HTML' })
                });

                if(res.ok) {
                    items.splice(selectedIndex, 1);
                    localStorage.setItem('user_inventory', JSON.stringify(items));
                    closeModal();
                    loadProfile();
                    tg.showAlert("‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É!");
                }
            } catch (e) {
                tg.showAlert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏.");
            }
        }

        function handleSell() {
            let items = JSON.parse(localStorage.getItem('user_inventory')) || [];
            const item = items[selectedIndex];
            const price = ITEMS_DB[item.id]?.price || 1;
            let s = parseInt(localStorage.getItem('user_stars')) || 0;
            
            localStorage.setItem('user_stars', (s + price).toString());
            items.splice(selectedIndex, 1);
            localStorage.setItem('user_inventory', JSON.stringify(items));
            
            closeModal();
            loadProfile();
            tg.HapticFeedback.notificationOccurred('success');
        }

        function activatePromo() {
            const input = document.getElementById('promo-input');
            const code = input.value.trim().toUpperCase();
            
            if (code === 'START') {
                let used = JSON.parse(localStorage.getItem('used_promos')) || [];
                if(used.includes('START')) return tg.showAlert("–£–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!");
                let s = parseInt(localStorage.getItem('user_stars')) || 0;
                localStorage.setItem('user_stars', (s + 500).toString());
                used.push('START');
                localStorage.setItem('used_promos', JSON.stringify(used));
                tg.showAlert("–£—Å–ø–µ—Ö! +500 ‚≠ê");
                loadProfile();
            } else {
                tg.showAlert("–ö–æ–¥ –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω");
            }
            input.value = '';
        }

        function closeModal() { document.getElementById('item-modal').style.display = 'none'; }

        window.onload = () => {
            const u = tg.initDataUnsafe?.user;
            if(u) {
                document.getElementById('user-name').innerText = u.first_name.toUpperCase();
                document.getElementById('user-avatar').src = u.photo_url || 'https://ui-avatars.com/api/?name=' + u.first_name;
            }
            loadProfile();
        }
    </script>
</body>
</html>
